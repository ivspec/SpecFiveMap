{% if customer %}
<!-- Membership Progress Markup -->
<div class="cart-shipping__wrapper">
  <!-- Customer Tier -->
  <p class="cart-shipping__tierLabel"></p>
  <!-- Dynamic Progress Message -->
  <p class="cart-shipping__progressMessage"></p>
  <div class="cart-shippingThreshold__bar">
    <span class="cart-shippingThreshold__progress"></span>
  </div>
  <!-- Start and End Values -->
  <div class="cart-shippingThreshold__values">
    <span class="cart-shippingThreshold__startValue">$0</span>
    <span class="cart-shippingThreshold__endValue">$500</span>
  </div>
  <!-- Pill Containers -->
  <div class="cart-shipping__pillContainer">
    <span class="cart-shipping__currentSpent">Spent: $0</span>
    <span class="cart-shipping__remainingGoal">Remaining: $500</span>
  </div>
  <!-- Club Member Discount Message -->
  {% if customer.tags contains 'coupon1' %}
  <p class="cart-shipping__discountMessage" style="display: none;">Congratulations, use code <strong>CLUB500</strong> for 10% OFF the Ranger Magnum or the Pulse Pack!</p>
  {% endif %}
  <!-- Wade Blake Discount Message -->
  {% if customer.tags contains 'wadeblake' %}
  <p class="cart-shipping__discountMessage">Discount Code: <strong>WADE10</strong> for $10 off your next order</p>
  {% endif %}
  <!-- Elite Member Priority Shipping Message -->
  <p class="cart-shipping__eliteMessage" style="display: none;">You have earned FREE Priority Shipping! Use code <strong>ELITE1000</strong> to claim!</p>
</div>

<style>
/* Wrapper Styling */
.cart-shipping__wrapper {
  padding: 20px;
  margin: 0 auto;
  max-width: 1200px; !important
  width: 95%; /* Ensure responsiveness */
  color: white !important;
  text-align: center;
  border-radius: 8px;
}

/* Restrict wrapper width to 1200px for laptops and desktops */
@media (min-width: 1024px) {
  .cart-shipping__wrapper {
    width: 1200px !important;
  }
}

/* Progress Bar Styling */
.cart-shippingThreshold__bar {
  position: relative;
  background-color: #0e0e0e;
  height: 2.5rem;
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 0.5rem;
  width: 100%; /* Default for larger screens */
}

.cart-shippingThreshold__progress {
  position: absolute;
  top: 0;
  left: 0;
  min-width: 0;
  max-width: 100%;
  height: 100%;
  display: block;
  background-color: #04FF85;
  transition: width 0.3s ease;
  border-radius: 8px;
}

/* Tier Label Styling */
.cart-shipping__tierLabel {
  font-family: Arial, Helvetica, sans-serif;
  font-size: 36px; /* Further increased font size */
  font-weight: bold; /* Reverted to original weight */
  margin: 0 0 10px 0;
  text-transform: uppercase;
  color: white;
}

/* Progress Message Styling */
.cart-shipping__progressMessage {
  font-family: 'Inter', sans-serif;
  font-size: 18px; /* Increased font size */
  font-weight: normal;
  text-align: center;
  margin-bottom: 15px;
  color: white;
}

/* Start and End Values Styling */
.cart-shippingThreshold__values {
  display: flex;
  justify-content: space-between;
  margin-top: 0.5rem;
  color: white;
  padding-top: 5px;
  font-family: 'Inter', sans-serif;
  font-size: 16px; /* Increased font size */
}

/* Pill Container Styling */
.cart-shipping__pillContainer {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
  gap: 10px;
  flex-wrap: wrap; /* Ensure pills stack if needed */
}

/* Spent Pill Styling */
.cart-shipping__currentSpent,
.cart-shipping__remainingGoal {
  font-family: 'Inter', sans-serif;
  font-size: 16px; /* Increased font size */
  font-weight: bold;
  padding: 9px 15px;
  border-radius: 25px;
  display: inline-block;
  text-align: center;
  white-space: nowrap;
}

/* Different Colors for Spent and Remaining */
.cart-shipping__currentSpent {
  color: #181818;
  background-color: #04FF85;
}

.cart-shipping__remainingGoal {
  color: white;
  background-color: #0e0e0e;
}

/* Discount and Elite Messages */
.cart-shipping__discountMessage,
.cart-shipping__eliteMessage {
  font-family: 'Inter', sans-serif;
  font-size: 18px; /* Increased font size */
  font-weight: bold;
  color: #FFDD57;
  margin-top: 10px;
  text-align: center;
  border: 1px solid white; /* Add a white border */
  border-radius: 8px; /* Round corners for a coupon effect */
  padding: 10px; /* Add padding inside the border */
  background-color: #181818; /* Subtle background color */
}

/* Responsive Design */
@media (max-width: 768px) {
  .cart-shipping__wrapper {
    padding: 15px;
    width: 100%; /* Ensure it fits on smaller screens */
  }

  .cart-shippingThreshold__bar {
    width: 90%; !important 
    margin: 0 auto; /* Center it horizontally */
  }

  .cart-shipping__tierLabel {
    font-size: 32px; /* Adjust for smaller screens */
  }

  .cart-shipping__progressMessage {
    font-size: 16px; /* Increased font size */
  }

  .cart-shippingThreshold__values {
    font-size: 14px; /* Increased font size */
  }

  .cart-shipping__pillContainer {
    flex-direction: column;
    align-items: center;
  }

  .cart-shipping__currentSpent,
  .cart-shipping__remainingGoal {
    font-size: 14px; /* Increased font size */
    padding: 7px 10px;
  }
}

@media (max-width: 480px) {
  .cart-shipping__wrapper {
    padding: 10px;
    width: 100%; /* Fill entire mobile width */
  }

  .cart-shippingThreshold__bar {
    width: 90%; /* Ensure the progress bar takes 90% of the screen width */
    margin: 0 auto; /* Center it horizontally */
  }

  .cart-shipping__tierLabel {
    font-size: 28px; /* Adjust for smaller screens */
  }

  .cart-shipping__progressMessage {
    font-size: 14px; /* Increased font size */
  }

  .cart-shippingThreshold__values {
    font-size: 12px; /* Increased font size */
  }

  .cart-shipping__pillContainer {
    gap: 5px;
  }

  .cart-shipping__currentSpent,
  .cart-shipping__remainingGoal {
    font-size: 12px; /* Increased font size */
    padding: 5px 8px;
  }
}
</style>


<script>
  function calculateProgress(currentVal, targetVal) {
    var progressBar = document.querySelector('.cart-shippingThreshold__progress');

    // Calculate progress percentage
    var percentage = Math.min((currentVal / targetVal) * 100, 100);
    progressBar.style.width = percentage + "%";

    // Return the percentage for further use
    return percentage;
  }

  document.addEventListener('DOMContentLoaded', function () {
    var customerTotalSpent = {{ customer.total_spent | divided_by: 100 }};

    const tierLabel = document.querySelector('.cart-shipping__tierLabel');
    const progressMessage = document.querySelector('.cart-shipping__progressMessage');
    const discountMessage = document.querySelector('.cart-shipping__discountMessage');
    const eliteMessage = document.querySelector('.cart-shipping__eliteMessage');
    const startValueEl = document.querySelector('.cart-shippingThreshold__startValue');
    const endValueEl = document.querySelector('.cart-shippingThreshold__endValue');
    const currentSpentEl = document.querySelector('.cart-shipping__currentSpent');
    const remainingGoalEl = document.querySelector('.cart-shipping__remainingGoal');

    let tier, nextTier, nextGoal, amountNeeded, startValue, endValue;
    if (customerTotalSpent < 500) {
      tier = "MEMBER";
      nextTier = "CLUB MEMBER";
      nextGoal = 500;
      startValue = 0;
      endValue = 500;
      amountNeeded = nextGoal - customerTotalSpent;
      discountMessage.style.display = "none";
      eliteMessage.style.display = "none";
    } else if (customerTotalSpent >= 500 && customerTotalSpent < 1000) {
      tier = "CLUB MEMBER";
      nextTier = "ELITE MEMBER";
      nextGoal = 1000;
      startValue = 500;
      endValue = 1000;
      amountNeeded = nextGoal - customerTotalSpent;
      discountMessage.style.display = "block";
      eliteMessage.style.display = "none";
    } else {
      tier = "ELITE MEMBER";
      nextTier = "";
      startValue = 500;
      endValue = 1000;
      amountNeeded = 0;
      discountMessage.style.display = "block";
      eliteMessage.style.display = "block";
      document.querySelector('.cart-shippingThreshold__bar').style.display = "block";
      document.querySelector('.cart-shippingThreshold__progress').style.width = "100%";
      document.querySelector('.cart-shippingThreshold__values').style.display = "flex";
      document.querySelector('.cart-shippingThreshold__startValue').textContent = "$500";
      document.querySelector('.cart-shippingThreshold__endValue').textContent = "$1000";
      document.querySelector('.cart-shipping__remainingGoal').textContent = "Remaining: $0";
    }

    tierLabel.textContent = tier;
    calculateProgress(customerTotalSpent, nextGoal);

    if (amountNeeded > 0) {
      progressMessage.textContent = You are $${amountNeeded.toFixed(2)} away from reaching ${nextTier}!;
    } else {
      progressMessage.textContent = Congratulations! You've reached the Elite Member status!;
    }

    currentSpentEl.textContent = Spent: $${customerTotalSpent.toFixed(2)};
    remainingGoalEl.textContent = Remaining: $${amountNeeded.toFixed(2)};
    startValueEl.textContent = $${startValue};
    endValueEl.textContent = $${endValue};
  });
</script>
{% else %}
<p>Please <a href="/account/login">log in</a> to see your membership progress.</p>
{% endif %}